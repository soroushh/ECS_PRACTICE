flaskapp:
  build: ./flaskapp-docker

alembic:
  build: .
  encrypted_env_file:
    - prod_db_url.encrypted

#  environment:
#    - DATABASE_URI=postgresql://postgres:Kati8212579!@my-database.cvgmzutcx9w8.eu-west-1.rds.amazonaws.com/postgres

nginx:
  build: ./nginx
  links:
    - flaskapp

dockercfgGenerator:
  image: codeship/aws-ecr-dockercfg-generator
  add_docker: true
  encrypted_env_file:
    - env.encrypted

awsdeployment:
  image: codeship/aws-deployment
  encrypted_env_file:
    - env.encrypted
  environment:
    - AWS_DEFAULT_REGION=eu-west-1
  volumes:
    - ./:/deploy
